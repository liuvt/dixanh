@page "/vehicle-statuses"
@inject IVehicleStatusService vehicleStatusService

<PageTitle>Trạng thái xe - Đi Xanh</PageTitle>
<AuthorizeView Context="authContext">
    <Authorized>
        <section class="rounded-xl border border-slate-200 bg-white shadow-sm">
            <div class="p-4">
                <div class="text-xl font-semibold text-slate-900">Danh mục trạng thái xe</div>
                <div class="mt-3 overflow-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-slate-50">
                            <tr class="text-left text-slate-600">
                                <th class="px-4 py-3 font-medium">Id</th>
                                <th class="px-4 py-3 font-medium">Code</th>
                                <th class="px-4 py-3 font-medium">Name</th>
                                <th class="px-4 py-3 font-medium">IsActive</th>
                                <th class="px-4 py-3 font-medium">Sort</th>
                                <th class="px-4 py-3 font-medium">Action</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-200">
                            @foreach (var s in _items)
                            {
                                <tr class="hover:bg-slate-50">
                                    <td class="px-4 py-3">@s.StatusId</td>
                                    <td class="px-4 py-3">@s.Code</td>
                                    <td class="px-4 py-3">
                                        <input class="w-full rounded-lg border-slate-300"
                                               @bind="s.Name" />
                                    </td>
                                    <td class="px-4 py-3">
                                        <input type="checkbox" @bind="s.IsActive" />
                                    </td>
                                    <td class="px-4 py-3">
                                        <input type="number" class="w-24 rounded-lg border-slate-300" @bind="s.SortOrder" />
                                    </td>
                                    <td class="px-4 py-3">
                                        <button class="rounded-lg bg-emerald-600 px-3 py-1.5 text-white hover:bg-emerald-700"
                                                @onclick="() => SaveAsync(s)">
                                            Save
                                        </button>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </Authorized>
    <NotAuthorized>
    </NotAuthorized>
</AuthorizeView>


@code {
    private List<VehicleStatus> _items = new();

    protected override async Task OnInitializedAsync()
    {
        _items = await vehicleStatusService.GetAllAsync(onlyActive: false);
    }

    private async Task SaveAsync(VehicleStatus s)
    {
        await vehicleStatusService.UpdateAsync(s.StatusId, s.Name, s.IsActive, s.SortOrder);
        _items = await vehicleStatusService.GetAllAsync(onlyActive: false);
    }
}
